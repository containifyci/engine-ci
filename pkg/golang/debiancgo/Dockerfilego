FROM golang:1.25.5

RUN apt-get update && \
    apt-get install -y clang build-essential \
    libssl-dev \
    gcc \
    libc6-dev \
    pkg-config \
    ca-certificates && \
    apt-get clean -y && \
    apt-get autoremove -y && \
    rm -rf /tmp/* /var/tmp/* && \
    rm -rf /var/lib/apt/lists/*

# libbtrfs-dev is needed by podman go module
RUN apt-get update && \
  apt-get install -y git openssh-client libbtrfs-dev && \
  apt-get clean -y && \
  apt-get autoremove -y && \
  rm -rf /tmp/* /var/tmp/* && \
  rm -rf /var/lib/apt/lists/*

# RUN go install github.com/pact-foundation/pact-go/v2@v2.4.1 && \
#   pact-go -l DEBUG install && \
#   go clean -cache && \
#   go clean -modcache

ARG TARGETARCH
RUN ZIG_VERSION=0.15.2 && \
    case "$(dpkg --print-architecture)" in \
      arm64) ZIG_ARCH=aarch64 ;; \
      amd64) ZIG_ARCH=x86_64 ;; \
    esac && \
    echo curl -L "https://ziglang.org/download/${ZIG_VERSION}/zig-${ZIG_ARCH}-linux-${ZIG_VERSION}.tar.xz" && \
    curl -L "https://ziglang.org/download/${ZIG_VERSION}/zig-${ZIG_ARCH}-linux-${ZIG_VERSION}.tar.xz" | \
    tar -xJ -C /usr/local && \
    ln -s "/usr/local/zig-${ZIG_ARCH}-linux-${ZIG_VERSION}/zig" /usr/local/bin/zig

ENV CGO_ENABLED=1
ENV OPENSSL_DIR=/usr/include/openssl
ENV CGO_CFLAGS="-I/usr/include/openssl"
ENV CGO_LDFLAGS="-lssl -lcrypto"
